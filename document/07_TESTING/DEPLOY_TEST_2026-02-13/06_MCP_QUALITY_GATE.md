# 06. MCP 품질 게이트 (적합성/효율성/재사용성)

## 1) 대상 툴군

- `user.login`
- `user.refreshToken`
- `course.share*`
- `lecture.grant*`
- `render.*`

## 2) 배포 차단 기준

1. 세 축 평균 점수 `4.0/5.0` 이상
2. 단일 항목 `3.0/5.0` 미만이면 즉시 중단
3. Critical 툴에서 Blocker 1건 이상이면 즉시 중단

## 3) 평가 문항

| ID | 축 | 체크 문항 | 합격 기준 |
|---|---|---|---|
| M-Q-01 | 적합성 | 툴 책임이 단일하고 명확한가 | 1툴 1목적 원칙 충족 |
| M-Q-02 | 적합성 | 정책과 실제 권한 동작이 일치하는가 | 불일치 0건 |
| M-Q-03 | 적합성 | 오류 계약(코드/메시지)이 일관적인가 | 500 누수 없음 |
| M-Q-04 | 적합성 | 상태 전이 규칙 위반 호출을 차단하는가 | 정의된 전이만 허용 |
| M-Q-05 | 적합성 | 매핑 무결성 위반 입력을 차단하는가 | 거부 + DB 무변경 |
| M-E-01 | 효율성 | p95 응답시간이 기준 내인가 | 조회 < 500ms, 변경 < 800ms |
| M-E-02 | 효율성 | N+1/중복 쿼리 패턴이 없는가 | 불필요 쿼리 없음 |
| M-E-03 | 효율성 | 재시도 시 중복 부작용이 없는가 | 중복 생성 0건 |
| M-E-04 | 효율성 | SSE 재연결 뒤 성능 저하가 없는가 | timeout/error 급증 없음 |
| M-R-01 | 재사용성 | 유사 로직이 공통 함수로 추출되었는가 | 중복 블록 최소화 |
| M-R-02 | 재사용성 | 검증/응답 포맷이 재사용 가능한가 | 신규 툴 추가 시 복붙 최소 |
| M-R-03 | 재사용성 | 출처 분리 규칙(`manual/course_share`)이 일관적인가 | 규칙 위반 0건 |

## 4) 측정 규칙

1. 각 핵심 툴 `n=100` 호출 표본 확보
2. 단일 사용자와 동시 사용자(10명) 모두 측정
3. p50/p95/error-rate를 함께 기록
4. 동일 시나리오 2회 반복 측정해 편차 확인

## 5) 증빙 필수

- 성능 raw 로그
- 실패 재현 로그(요청/응답/DB before-after)
- 중복/무결성 SQL 결과
- 코드 중복 점검 노트(`rg` 검색 근거 포함)

